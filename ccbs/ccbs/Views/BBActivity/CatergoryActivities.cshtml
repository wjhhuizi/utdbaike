@model ccbs.Models.BBCategory
@{
    ViewBag.Title = "CatergoryActivities";
    ccbs.Models.BBUser currentBBUser = ViewBag.currentBBUser;
    List<ccbs.Models.BBActivity> futureActivities = ViewBag.futureActivities;
}
<h2>
    Activities in @Model.Name</h2>
<ul>
    @foreach (var activity in futureActivities)
    {
        string toggleId = "toggle" + activity.Id;
        string schedId = "sched" + activity.Id;
        <li>
            <div>
                @Html.ActionLink(@activity.Title, "BBActivityDetails", "BBActivity", new { id = activity.Id }, null)
            </div>
            <div>
                <span style="font-size: small; color: Blue;">Post By @activity.Creater.Name</span>
            </div>
            <a id="@toggleId" onclick="toggleSchedule('@schedId')">Expand schedule</a>
            <div id="@schedId">
                <ul>
                    @foreach (var sched in activity.BBRegisterEntries)
                    {
                        <li>
                            <p>
                                Time: @sched.Time.ToString("MM/dd/yyyy HH:mm")</p>
                            <p>
                                Address: @sched.Address</p>
                            <p>
                                Contact: @sched.Contact</p>
                            @if (sched.IsActive)
                            {
                                if (sched.RegisteredBBUsers.Contains(currentBBUser))
                                {
                                <span>@Html.ActionLink("I Leave", "CancelBBActivity", "BBActivity", new { Rid = sched.Id, Uid = currentBBUser.Id, returnUrl = Request.RawUrl }, new { title = "点击取消我的报名" })</span>
                                }
                                else
                                {
                                <span>@Html.ActionLink("I Join", "AttendBBActivity", "BBActivity", new { Rid = sched.Id, returnUrl = Request.RawUrl }, new { title = "点击我要报名参加" })</span>
                                }
                            }
                        </li>
                    }
                </ul>
            </div>
        </li>
    }
</ul>
<script type="text/javascript">
    function toggleSchedule(scheduleId) {
        $('#' + scheduleId).toggle();
    }
</script>
